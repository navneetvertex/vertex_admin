<!-- <app-loader></app-loader> -->
<div class="container-fluid" *ngIf="data">

    <app-page-title title="Admin Dashboard" [breadcrumbItems]="[{ label: 'Dashboards' }, { label: 'Admin Dashboard', active: true }]"></app-page-title>

    <!-- Welcome Card -->
    <div class="row">
        <div class="col-xl-4">
            <div class="card overflow-hidden profile-card shadow-sm">
                <div class="profile-header bg-gradient-primary">
                    <div class="row align-items-center">
                        <div class="col-7">
                            <div class="text-white p-4">
                                <h5 class="text-white mb-2 fw-bold">Welcome Back!</h5>
                                <p class="text-white-50 mb-0 small">Vertex Kalyan Cooperative Urban Thrift & Credit Society Ltd.</p>
                            </div>
                        </div>
                        <div class="col-5 align-self-end">
                            <img src="assets/images/profile-img.png" alt="" class="img-fluid profile-header-img">
                        </div>
                    </div>
                </div>
                <div class="card-body pt-0">
                    <div class="row">
                        <div class="col-sm-12 text-center">
                            <div class="avatar-container mt-n5 mb-3">
                                <img src="assets/images/users/user_placeholder.png" alt="" class="avatar-xl rounded-circle border border-4 border-white shadow-sm">
                            </div>
                            <h5 class="font-size-16 fw-bold mb-1">Administrator</h5>
                            <p class="text-muted mb-3 font-size-13">
                                <i class="bx bx-shield me-1"></i>System Admin
                            </p>
                        </div>
                    </div>

                    <div class="user-info-grid mt-3">
                        <div class="info-item">
                            <div class="info-icon bg-soft-success">
                                <i class="bx bx-group text-success"></i>
                            </div>
                            <div class="info-content">
                                <span class="text-muted small">Active Members</span>
                                <h6 class="mb-0 fw-bold">{{data?.activeUsers}}</h6>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon bg-soft-primary">
                                <i class="bx bx-store text-primary"></i>
                            </div>
                            <div class="info-content">
                                <span class="text-muted small">Franchises</span>
                                <h6 class="mb-0 fw-bold">{{data?.totalFranchises}}</h6>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon bg-soft-info">
                                <i class="bx bx-user-check text-info"></i>
                            </div>
                            <div class="info-content">
                                <span class="text-muted small">Advisors</span>
                                <h6 class="mb-0 fw-bold">{{data?.agentUsers}}</h6>
                            </div>
                        </div>
                        <div class="info-item">
                            <div class="info-icon bg-soft-warning">
                                <i class="bx bx-sitemap text-warning"></i>
                            </div>
                            <div class="info-content">
                                <span class="text-muted small">SHG Coordinators</span>
                                <h6 class="mb-0 fw-bold">{{data?.shg_coordinator}}</h6>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <a routerLink="/members" class="btn btn-primary btn-block w-100 btn-rounded">
                            <i class="bx bx-user me-2"></i>View All Members
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-8">
            <div class="row g-3">
                <div *ngFor="let stat of statIncomeData" class="col-md-6">
                    <app-stat [title]="stat.title" [value]="'₹'+(stat.value | number)" [icon]="stat.icon"></app-stat>
                </div>
            </div>
            <div class="row g-3 mt-1">
                <div *ngFor="let stat of statData" class="col-md-4">
                    <app-stat [title]="stat.title" [value]="'₹'+(stat.value | number)" [icon]="stat.icon"></app-stat>
                </div>
            </div>
        </div>
    </div>

    <!-- Financial Stats Cards -->
    

    <!-- Financial Metrics Section -->
    <div class="row mt-3">
        <div class="col-12">
            <div class="card shadow-sm modern-metrics-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="icon-box bg-soft-primary me-3">
                            <i class="bx bx-pie-chart-alt-2 text-primary font-size-24"></i>
                        </div>
                        <div>
                            <h4 class="card-title mb-0 fw-bold">Financial Metrics & Income Summary</h4>
                            <p class="text-muted mb-0 small">Comprehensive financial overview</p>
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-primary">
                                    <i class="bx bx-money text-primary"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Total Fees Amount</p>
                                    <h5 class="mb-0 fw-bold">₹{{data?.total_amount | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-warning">
                                    <i class="bx bx-wallet text-warning"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Shared Money</p>
                                    <h5 class="mb-0 fw-bold">₹{{data?.shared_money | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-info">
                                    <i class="bx bx-calculator text-info"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Loan Interest</p>
                                    <h5 class="mb-0 fw-bold">₹{{(data?.loan_interest_details?.totalPaid + data?.loan_interest_details?.totalRemaining) | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-danger">
                                    <i class="bx bx-credit-card text-danger"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Sahyog Card Interest</p>
                                    <h5 class="mb-0 fw-bold">₹{{data?.cc_interest | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-success">
                                    <i class="bx bx-trending-up text-success"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Direct Referral Income</p>
                                    <h5 class="mb-0 fw-bold">₹{{data?.directReferralAmount | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-success">
                                    <i class="bx bx-sitemap text-success"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Indirect Referral Income</p>
                                    <h5 class="mb-0 fw-bold">₹{{data?.indirectReferralAmount | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-info">
                                    <i class="bx bx-store text-info"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Franchise Referral Income</p>
                                    <h5 class="mb-0 fw-bold">₹{{data?.franchiseReferralAmount | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card highlight-card">
                                <div class="metric-icon bg-soft-primary">
                                    <i class="bx bx-pie-chart-alt-2 text-primary"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Total Income Summary</p>
                                    <h5 class="mb-0 fw-bold text-primary">₹{{(data?.directReferralAmount + data?.indirectReferralAmount + data?.franchiseReferralAmount + data?.loan_interest_details?.totalRemaining + data?.cc_interest + data?.loan_interest_details?.totalPaid + data?.total_amount) | number}}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Commission Summary Section -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm modern-metrics-card">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="icon-box bg-soft-success me-3">
                            <i class="bx bx-bar-chart text-success font-size-24"></i>
                        </div>
                        <div>
                            <h4 class="card-title mb-0 fw-bold">Commission Summary</h4>
                            <p class="text-muted mb-0 small">Admin and advisor commission breakdown</p>
                        </div>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-primary">
                                    <i class="bx bx-money text-primary"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Admin Direct Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{totalCommission?.totalDirectCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-info">
                                    <i class="bx bx-sitemap text-info"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Admin Indirect Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{totalCommission?.totalIndirectCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-warning">
                                    <i class="bx bx-wallet text-warning"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Admin Card Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{totalCommission?.totalCreditCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-danger">
                                    <i class="bx bx-trending-up text-danger"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Admin Loan Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{totalCommission?.totalLoanCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-success">
                                    <i class="bx bx-user-check text-success"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Advisor Direct Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{advisorCommission?.totalAdvisorDirectCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-success">
                                    <i class="bx bx-bar-chart text-success"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Advisor Indirect Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{advisorCommission?.totalAdvisorIndirectCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-info">
                                    <i class="bx bx-line-chart text-info"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Advisor Loan Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{advisorCommission?.totalAdvisorLoanCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="metric-card">
                                <div class="metric-icon bg-soft-warning">
                                    <i class="bx bx-credit-card text-warning"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Advisor Card Commission</p>
                                    <h5 class="mb-0 fw-bold">₹{{advisorCommission?.totalAdvisorCreditCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-12">
                            <div class="metric-card highlight-card">
                                <div class="metric-icon bg-soft-primary">
                                    <i class="bx bx-calculator text-primary"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Admin Grand Total</p>
                                    <h5 class="mb-0 fw-bold text-primary">₹{{totalCommission?.grandTotal | number}}</h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-sm-12">
                            <div class="metric-card highlight-card">
                                <div class="metric-icon bg-soft-success">
                                    <i class="bx bx-bar-chart-alt-2 text-success"></i>
                                </div>
                                <div class="metric-content">
                                    <p class="text-muted mb-1 small">Advisor Grand Total</p>
                                    <h5 class="mb-0 fw-bold text-success">₹{{advisorCommission?.totalAdvisorCommission | number}}</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Charts -->
    <div class="row g-3 mt-1"> 
        <div class="col-xl-6">
            <div class="card shadow-sm chart-card">
                <div class="card-body">
                    <div class="d-sm-flex flex-wrap align-items-center mb-4">
                        <div class="me-auto">
                            <h4 class="card-title mb-1 fw-bold">Transactions (Deposits)</h4>
                            <p class="text-muted mb-0 small">Deposit activity overview</p>
                        </div>
                        <div class="ms-auto mt-3 mt-sm-0">
                            <ul class="nav nav-pills nav-pills-custom">
                                <li class="nav-item">
                                    <a class="nav-link px-3" href="javascript: void(0);" (click)="monthlyreport()"
                                        [ngClass]="{'active': isActive === 'month'}">
                                        <i class="bx bx-calendar me-1"></i>Month
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link px-3" href="javascript: void(0);"
                                        [ngClass]="{'active': isActive === 'week'}" (click)="weeklyreport()">
                                        <i class="bx bx-calendar-week me-1"></i>Week
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <apx-chart #chart dir="ltr" class="apex-charts" [chart]="emailSentBarChart.chart"
                        [series]="emailSentBarChart.series" [legend]="emailSentBarChart.legend"
                        [colors]="emailSentBarChart.colors" [fill]="emailSentBarChart.fill"
                        [dataLabels]="emailSentBarChart.dataLabels" [xaxis]="emailSentBarChart.xaxis"
                        [plotOptions]="emailSentBarChart.plotOptions">
                    </apx-chart>
                </div>
            </div>
        </div>
        <div class="col-xl-6">
            <div class="card shadow-sm chart-card">
                <div class="card-body">
                    <div class="d-sm-flex flex-wrap align-items-center mb-4">
                        <div class="me-auto">
                            <h4 class="card-title mb-1 fw-bold">Transactions (Loan & Sahyog Card)</h4>
                            <p class="text-muted mb-0 small">Loan and credit card activity</p>
                        </div>
                        <div class="ms-auto mt-3 mt-sm-0">
                            <ul class="nav nav-pills nav-pills-custom">
                                <li class="nav-item">
                                    <a class="nav-link px-3" href="javascript: void(0);" (click)="monthlyLoanCreditreport()"
                                        [ngClass]="{'active': isActiveLoanCredit === 'month'}">
                                        <i class="bx bx-calendar me-1"></i>Month
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link px-3" href="javascript: void(0);"
                                        [ngClass]="{'active': isActiveLoanCredit === 'week'}" (click)="weeklyreport()">
                                        <i class="bx bx-calendar-week me-1"></i>Week
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <apx-chart #chart dir="ltr" class="apex-charts" [chart]="LoanCreditBarChart.chart"
                        [series]="LoanCreditBarChart.series" [legend]="LoanCreditBarChart.legend"
                        [colors]="LoanCreditBarChart.colors" [fill]="LoanCreditBarChart.fill"
                        [dataLabels]="LoanCreditBarChart.dataLabels" [xaxis]="LoanCreditBarChart.xaxis"
                        [plotOptions]="LoanCreditBarChart.plotOptions">
                    </apx-chart>
                </div>
            </div>
        </div>
    </div>
</div> <!-- container-fluid -->

